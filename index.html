<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Firearms Atlas</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Firearms Atlas</h1>
  </header>

  <!-- 🔍 Vyhľadávanie a filtre -->
  <section class="filters">
    <input type="text" id="searchInput" placeholder="Hľadať podľa názvu..." />
    
    <select id="categoryFilter">
      <option value="">Všetky kategórie</option>
    </select>

    <select id="caliberFilter">
      <option value="">Všetky kalibre</option>
    </select>

    <select id="manufacturerFilter">
      <option value="">Všetci výrobcovia</option>
    </select>

    <select id="countryFilter">
      <option value="">Všetky krajiny</option>
    </select>
  </section>

  <!-- 📦 Výpis zbraní -->
  <main id="gunContainer" class="card-container">
    <!-- Karty so zbraňami sa sem načítajú -->
  </main>

  <!-- ⚙️ Skript -->
  <script>
    let gunsData = [];

    // Načítanie dát zo JSON súboru
    async function loadGuns() {
      const response = await fetch('guns.json');
      gunsData = await response.json();
      populateFilters(gunsData);
      displayGuns(gunsData);
    }

    // Vygenerovanie možností do filtrov
    function populateFilters(data) {
      const categorySet = new Set();
      const caliberSet = new Set();
      const manufacturerSet = new Set();
      const countrySet = new Set();

      data.forEach(gun => {
        categorySet.add(gun.category);
        caliberSet.add(gun.caliber);
        manufacturerSet.add(gun.manufacturer);
        countrySet.add(gun.country);
      });

      fillSelect('categoryFilter', categorySet);
      fillSelect('caliberFilter', caliberSet);
      fillSelect('manufacturerFilter', manufacturerSet);
      fillSelect('countryFilter', countrySet);
    }

    function fillSelect(selectId, values) {
      const select = document.getElementById(selectId);
      values = Array.from(values).sort();
      values.forEach(val => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = val;
        select.appendChild(option);
      });
    }

    // Zobrazenie kariet
    function displayGuns(data) {
      const container = document.getElementById('gunContainer');
      container.innerHTML = '';

      if (data.length === 0) {
        container.innerHTML = '<p>Žiadne zbrane nevyhovujú filtrom.</p>';
        return;
      }

      data.forEach(gun => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${gun.image}" alt="${gun.name}">
          <h2>${gun.name}</h2>
          <p><strong>Výrobca:</strong> ${gun.manufacturer}</p>
          <p><strong>Kaliber:</strong> ${gun.caliber}</p>
          <p><strong>Kategória:</strong> ${gun.category}</p>
          <p><strong>Krajina:</strong> ${gun.country}</p>
          <button onclick="location.href='detail.html?id=${gun.id}'">Zobraziť viac</button>
        `;
        container.appendChild(card);
      });
    }

    // Filtrovanie a vyhľadávanie
    function applyFilters() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const selectedCategory = document.getElementById('categoryFilter').value;
      const selectedCaliber = document.getElementById('caliberFilter').value;
      const selectedManufacturer = document.getElementById('manufacturerFilter').value;
      const selectedCountry = document.getElementById('countryFilter').value;

      const filtered = gunsData.filter(gun => {
        return (
          gun.name.toLowerCase().includes(searchTerm) &&
          (selectedCategory === '' || gun.category === selectedCategory) &&
          (selectedCaliber === '' || gun.caliber === selectedCaliber) &&
          (selectedManufacturer === '' || gun.manufacturer === selectedManufacturer) &&
          (selectedCountry === '' || gun.country === selectedCountry)
        );
      });

      displayGuns(filtered);
    }

    // Reaguj na zmeny
    document.addEventListener('DOMContentLoaded', () => {
      loadGuns();
      document.getElementById('searchInput').addEventListener('input', applyFilters);
      document.getElementById('categoryFilter').addEventListener('change', applyFilters);
      document.getElementById('caliberFilter').addEventListener('change', applyFilters);
      document.getElementById('manufacturerFilter').addEventListener('change', applyFilters);
      document.getElementById('countryFilter').addEventListener('change', applyFilters);
    });
  </script>
</body>
</html>
